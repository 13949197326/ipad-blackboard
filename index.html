<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÈªëÊùø">
    <link rel="manifest" href="manifest.json">
    <title>iPad ÈªëÊùø</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            position: fixed;
        }

        #blackboard {
            display: block;
            width: 100%;
            height: 100%;
            touch-action: none;
            transition: background-color 0.3s;
        }

        #blackboard.bg-black {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
        }

        #blackboard.bg-blue {
            background: linear-gradient(135deg, #1a2a3a 0%, #2a3a4a 50%, #1f2f3f 100%);
        }

        #blackboard.bg-green {
            background: linear-gradient(135deg, #0d1f0d 0%, #1a3a1a 50%, #152815 100%);
        }

        .toolbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.92);
            backdrop-filter: blur(20px);
            padding: 10px 16px;
            border-radius: 24px;
            display: flex;
            gap: 8px;
            align-items: center;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
        }

        .toolbar.hidden {
            opacity: 0;
            transform: translateX(-50%) translateY(-100px);
            pointer-events: none;
        }

        .tool-btn, .color-btn, .bg-btn, .brush-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 14px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .color-btn {
            border: 3px solid rgba(255, 255, 255, 0.4);
        }

        .color-btn.red { background: #ff4444; }
        .color-btn.white { background: #ffffff; color: #000; }
        .color-btn.green { background: #44ff44; }

        .bg-btn.black { background: #1a1a1a; }
        .bg-btn.blue { background: #2a3a4a; }
        .bg-btn.green { background: #1a3a1a; }

        .tool-btn.active, .color-btn.active, .bg-btn.active, .brush-btn.active {
            background: rgba(74, 144, 226, 0.7);
            border-color: rgba(74, 144, 226, 1);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        .color-btn.active {
            box-shadow: 0 0 20px currentColor;
        }

        .separator {
            width: 2px;
            height: 36px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1px;
        }

        .size-group {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 12px;
        }

        .size-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            width: 36px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .size-btn.active {
            background: rgba(74, 144, 226, 0.6);
            color: white;
        }

        #fullscreenBtn {
            font-size: 20px;
        }

        @media (orientation: portrait) {
            .toolbar {
                top: auto;
                bottom: 20px;
                flex-wrap: wrap;
                max-width: 95vw;
                gap: 6px;
            }
        }

        /* ÈöêËóèÂ∑•ÂÖ∑Ê†èÊèêÁ§∫ */
        .tap-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.3);
            font-size: 16px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tap-hint.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="toolbar" id="toolbar">
        <!-- Á¨îÂà∑Ê†∑Âºè -->
        <button id="normalBrush" class="brush-btn active" title="ÊôÆÈÄöÁ¨î">‚úèÔ∏è</button>
        <button id="softBrush" class="brush-btn" title="ËΩØÁ¨î">üñåÔ∏è</button>
        <button id="calligraphy" class="brush-btn" title="ÊØõÁ¨î">‚úíÔ∏è</button>

        <div class="separator"></div>

        <!-- È¢ÑËÆæÈ¢úËâ≤ -->
        <button id="redColor" class="color-btn red" title="Á∫¢Ëâ≤Á≤âÁ¨î"></button>
        <button id="whiteColor" class="color-btn white active" title="ÁôΩËâ≤Á≤âÁ¨î"></button>
        <button id="greenColor" class="color-btn green" title="ÁªøËâ≤Á≤âÁ¨î"></button>

        <div class="separator"></div>

        <!-- Ê©°ÁöÆÊì¶ -->
        <button id="eraserBtn" class="tool-btn" title="Ê©°ÁöÆÊì¶">üßΩ</button>

        <div class="separator"></div>

        <!-- Á≤óÁªÜË∞ÉËäÇ -->
        <div class="size-group">
            <button id="thinBtn" class="size-btn">ÁªÜ</button>
            <button id="mediumBtn" class="size-btn active">‰∏≠</button>
            <button id="thickBtn" class="size-btn">Á≤ó</button>
        </div>

        <div class="separator"></div>

        <!-- ËÉåÊôØÂàáÊç¢ -->
        <button id="bgBlack" class="bg-btn black active" title="ÈªëËâ≤ÈªëÊùø"></button>
        <button id="bgBlue" class="bg-btn blue" title="ËìùËâ≤ÈªëÊùø"></button>
        <button id="bgGreen" class="bg-btn green" title="ÁªøËâ≤ÈªëÊùø"></button>

        <div class="separator"></div>

        <!-- ÂäüËÉΩÊåâÈíÆ -->
        <button id="undoBtn" class="tool-btn" title="Êí§ÈîÄ">‚Ü∂</button>
        <button id="redoBtn" class="tool-btn" title="ÈáçÂÅö">‚Ü∑</button>
        <button id="clearBtn" class="tool-btn" title="Ê∏ÖÁ©∫">üóëÔ∏è</button>
        <button id="fullscreenBtn" class="tool-btn" title="ÂÖ®Â±è">‚õ∂</button>
    </div>

    <canvas id="blackboard" class="bg-black"></canvas>
    <div class="tap-hint" id="tapHint">ÂèåÂáªÂ±èÂπïÊòæÁ§∫/ÈöêËóèÂ∑•ÂÖ∑Ê†è</div>

    <script>
        const canvas = document.getElementById('blackboard');
        const ctx = canvas.getContext('2d');
        const toolbar = document.getElementById('toolbar');
        const tapHint = document.getElementById('tapHint');

        function resizeCanvas() {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(canvas, 0, 0);

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.drawImage(tempCanvas, 0, 0);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let isDrawing = false;
        let currentColor = '#ffffff';
        let currentSize = 3;
        let currentTool = 'pen';
        let brushStyle = 'normal'; // 'normal', 'soft', 'calligraphy'
        let lastX = 0;
        let lastY = 0;
        let history = [];
        let historyStep = -1;
        let toolbarVisible = true;
        let lastTapTime = 0;

        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        function saveState() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.toDataURL());
            if (history.length > 50) history.shift();
        }

        function undo() {
            if (historyStep > 0) {
                historyStep--;
                restoreState(history[historyStep]);
            }
        }

        function redo() {
            if (historyStep < history.length - 1) {
                historyStep++;
                restoreState(history[historyStep]);
            }
        }

        function restoreState(state) {
            const img = new Image();
            img.src = state;
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            saveState();
        }

        function getEventPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY, pressure = 0.5;

            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
                pressure = e.touches[0].force || 0.5;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
                pressure = e.pressure || 0.5;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top,
                pressure: pressure
            };
        }

        function startDraw(e) {
            if (e.target !== canvas) return;
            e.preventDefault();
            isDrawing = true;

            const pos = getEventPos(e);
            lastX = pos.x;
            lastY = pos.y;

            ctx.globalCompositeOperation = currentTool === 'pen' ? 'source-over' : 'destination-out';
            ctx.strokeStyle = currentColor;

            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();

            const pos = getEventPos(e);
            let lineWidth = currentSize;

            // ÂéãÊÑüÊîØÊåÅ
            if (pos.pressure > 0) {
                if (brushStyle === 'soft' || brushStyle === 'calligraphy') {
                    lineWidth = currentSize * (0.3 + pos.pressure * 2);
                } else {
                    lineWidth = currentSize * (0.5 + pos.pressure * 1.5);
                }
            }

            if (currentTool === 'eraser') {
                lineWidth *= 5;
            }

            // Á¨îÂà∑Ê†∑Âºè
            if (brushStyle === 'soft') {
                ctx.globalAlpha = 0.6;
                ctx.shadowBlur = lineWidth * 0.5;
                ctx.shadowColor = currentColor;
            } else if (brushStyle === 'calligraphy') {
                ctx.globalAlpha = 0.85;
                const angle = Math.atan2(pos.y - lastY, pos.x - lastX);
                lineWidth *= (0.7 + Math.abs(Math.sin(angle)) * 0.6);
            } else {
                ctx.globalAlpha = 1;
                ctx.shadowBlur = 0;
            }

            ctx.lineWidth = lineWidth;
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();

            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDraw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            isDrawing = false;
            ctx.globalAlpha = 1;
            ctx.shadowBlur = 0;
            saveState();
        }

        // ÂèåÂáªÂàáÊç¢Â∑•ÂÖ∑Ê†è
        canvas.addEventListener('touchstart', (e) => {
            const now = Date.now();
            if (now - lastTapTime < 300) {
                toolbarVisible = !toolbarVisible;
                toolbar.classList.toggle('hidden', !toolbarVisible);
                if (!toolbarVisible) {
                    tapHint.classList.add('show');
                    setTimeout(() => tapHint.classList.remove('show'), 2000);
                }
            }
            lastTapTime = now;
        });

        // Touch ‰∫ã‰ª∂
        canvas.addEventListener('touchstart', startDraw, { passive: false });
        canvas.addEventListener('touchmove', draw, { passive: false });
        canvas.addEventListener('touchend', stopDraw, { passive: false });
        canvas.addEventListener('touchcancel', stopDraw, { passive: false });

        // Mouse ‰∫ã‰ª∂
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);

        // Á¨îÂà∑Ê†∑ÂºèÂàáÊç¢
        document.getElementById('normalBrush').addEventListener('click', () => {
            brushStyle = 'normal';
            currentTool = 'pen';
            setActiveButton('brush', 'normalBrush');
        });

        document.getElementById('softBrush').addEventListener('click', () => {
            brushStyle = 'soft';
            currentTool = 'pen';
            setActiveButton('brush', 'softBrush');
        });

        document.getElementById('calligraphy').addEventListener('click', () => {
            brushStyle = 'calligraphy';
            currentTool = 'pen';
            setActiveButton('brush', 'calligraphy');
        });

        // È¢úËâ≤ÂàáÊç¢
        document.getElementById('redColor').addEventListener('click', () => {
            currentColor = '#ff4444';
            currentTool = 'pen';
            setActiveButton('color', 'redColor');
        });

        document.getElementById('whiteColor').addEventListener('click', () => {
            currentColor = '#ffffff';
            currentTool = 'pen';
            setActiveButton('color', 'whiteColor');
        });

        document.getElementById('greenColor').addEventListener('click', () => {
            currentColor = '#44ff44';
            currentTool = 'pen';
            setActiveButton('color', 'greenColor');
        });

        // Ê©°ÁöÆÊì¶
        document.getElementById('eraserBtn').addEventListener('click', () => {
            currentTool = 'eraser';
            document.getElementById('eraserBtn').classList.add('active');
        });

        // Á≤óÁªÜ
        document.getElementById('thinBtn').addEventListener('click', () => {
            currentSize = 2;
            setActiveButton('size', 'thinBtn');
        });

        document.getElementById('mediumBtn').addEventListener('click', () => {
            currentSize = 4;
            setActiveButton('size', 'mediumBtn');
        });

        document.getElementById('thickBtn').addEventListener('click', () => {
            currentSize = 7;
            setActiveButton('size', 'thickBtn');
        });

        // ËÉåÊôØÂàáÊç¢
        document.getElementById('bgBlack').addEventListener('click', () => {
            canvas.className = 'bg-black';
            setActiveButton('bg', 'bgBlack');
        });

        document.getElementById('bgBlue').addEventListener('click', () => {
            canvas.className = 'bg-blue';
            setActiveButton('bg', 'bgBlue');
        });

        document.getElementById('bgGreen').addEventListener('click', () => {
            canvas.className = 'bg-green';
            setActiveButton('bg', 'bgGreen');
        });

        // ÂäüËÉΩÊåâÈíÆ
        document.getElementById('undoBtn').addEventListener('click', undo);
        document.getElementById('redoBtn').addEventListener('click', redo);
        document.getElementById('clearBtn').addEventListener('click', () => {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÈªëÊùøÂêó?')) {
                clearCanvas();
            }
        });

        // ÂÖ®Â±è
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('ÂÖ®Â±èÂ§±Ë¥•:', err);
                });
            } else {
                document.exitFullscreen();
            }
        });

        function setActiveButton(group, activeId) {
            const groups = {
                'brush': ['.brush-btn'],
                'color': ['.color-btn'],
                'size': ['.size-btn'],
                'bg': ['.bg-btn']
            };

            if (groups[group]) {
                groups[group].forEach(selector => {
                    document.querySelectorAll(selector).forEach(btn => {
                        btn.classList.remove('active');
                    });
                });
                document.getElementById(activeId).classList.add('active');

                if (group !== 'size' && group !== 'bg') {
                    document.getElementById('eraserBtn').classList.remove('active');
                }
            }
        }

        saveState();
    </script>
</body>
</html>
